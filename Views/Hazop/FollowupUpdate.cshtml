@{
    ViewData["Title"] = "HAZOP Sub-Sofware";

    Layout = "~/Views/Shared/_LayoutWeb.cshtml";
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.3/angular.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&amp;display=swap"
          rel="stylesheet">

    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">

    <link rel="stylesheet" href="~/assets/css/theme.min.css">

    <link rel="stylesheet" href="~/assets/css/tablefreezer.css">

    <link href="~/assets/css/theme.min.css" type="text/css" rel="stylesheet" id="style-default">
    <link href="~/assets/css/choices.min.css" type="text/css" rel="stylesheet">

    <script src="~/assets/js/config.js"></script>
    <link rel="stylesheet" href="~/css/button.css" />
    <link rel="stylesheet" href="~/css/myStyles.css">
}

<div class="content mt-1 d-none" style="font-size: 12px; min-height: auto!important;" id="divPage" ng-controller="ctrlAppPage">

    <div class="row g-0">

        <div class="col-12">
            <div class="card shadow-sm p-2 mb-3 bg-light rounded">
                <div class="card-body p-2">
                    <div class="row gx-0 align-items-center">

                        <div class="card px-2 ">

                            <div class="row g-3 justify-content-between align-items-center pt-2 pb-3">

                                <div class="col-8 col-md">

                                    <div class="row">
                                        <div class="col-auto">
                                            <b>PHA No.:</b> <br>
                                            <span class="text-uppercase" ng-click="selectDocPreview()"> {{ (data_header[0].pha_version>0 ? data_header[0].pha_no : data_header[0].pha_sub_software + '-2023-00000XX')}}</span>

                                        </div>
                                        <div class="col-auto">
                                            <b>Revision :</b> <br>
                                            <span ng-if="data_header[0].pha_version>0 "> {{data_header[0].pha_version_text + '(' + data_header[0].pha_version_desc  +  ')'}}</span>
                                            <span ng-if="data_header[0].pha_version==0 "> - </span>
                                        </div>

                                        <div class="col-auto">
                                            <b>Request Status :</b> <br>
                                            <span> {{data_header[0].pha_status_displayname}}</span>
                                        </div>
                                        <div class="col-auto">
                                            <b>{{data_header[0].txt_project_name_header }} :</b> <br>
                                            <span> {{data_header[0].txt_project_name}}</span>
                                        </div>

                                    </div>

                                </div>
                                <div class="col-auto">
                                    <div class="d-flex align-items-center py-2 gap-4  justify-content-end" >
                                        <div class="d-flex align-items-center gap-2" ng-if="data_general[0].pha_status == 13 && flow_role_type != 'admin'">
                                            <label class="switch">
                                                <input type="checkbox" ng-model="toggleStatus" ng-change="toggleChanged()">
                                                <span class="slider round"></span>
                                            </label>
                                            <b ng-class="{'text-primary': toggleStatus}"> {{ toggleStatus ? user_name : 'All Tasks'}} </b>
                                        </div>
                                        <span class="mx-2" ng-if="cancle_type">
                                            <button class="btn btn-outline-secondary btn-sm" style="width: 100px;"
                                                    ng-click="confirmFollowBack()">
                                                Back
                                            </button>
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="row g-3 justify-content-between align-items-center pt-0 pb-0">
                                <div class="float-end align-top pt-2 ms-1 d-none">
                                    <div class="float-end pe-3">
                                        <div class="form-check form-switch cursor-pointer">
                                            <input class="form-check-input cursor-pointer" name="" id=""
                                                   type="checkbox"
                                                   ng-click="toggleTasksView()" />
                                            <label class="form-check-label cursor-pointer" for="" style="color:#a1a1a6">Show </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-12 col-md mx-1 ">

                                    <div class="table-responsive scrollbar tableFixHead ">
                                        <table ng-if="!(pha_sub_software == 'hra')" class="table fs--2 mb-0 table-bordered " style="border-collapse: collapse;"
                                               cellpadding="0" cellspacing="0">
                                            <thead class="text-uppercase  bg-light-secondary">

                                                @*follow up*@
                                                <tr class="text-center table-bordered" ng-if="flow_status !== 14">
                                                    <th class="sort align-middle" colspan="1" rowspan="3">
                                                        {{ pha_sub_software == 'hra' ? "Job Type/Change Type" : 'Recommendations No' }}
                                                    </th>
                                                    <th class="sort align-middle" colspan="1" rowspan="3" scope="col">
                                                        {{ pha_sub_software == 'whatif' ? 'Task' : pha_sub_software == 'hra' ? 'Group No' : 'Node' }}
                                                    </th>
                                                    <th class="sort align-middle" colspan="1" rowspan="3" scope="col">
                                                        {{ pha_sub_software == 'whatif' ? "What's if(Cause)" : pha_sub_software == 'hra' ? "Task or Activity" : 'Cause No' }}
                                                    </th>

                                                    @* Action Owner 13 *@
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col" ng-if="flow_status != 14">
                                                        {{ pha_sub_software == 'hra' ? "Worker Group" : 'Action Owner' }}
                                                    </th>

                                                    <th class="sort align-middle " colspan="1" rowspan="3" ng-if="flow_status != 14">
                                                        {{ pha_sub_software == 'hra' ? "Commnets" : 'Recommendations' }}
                                                    </th>

                                                    <th class="sort align-middle" colspan="2" rowspan="{{ pha_sub_software == 'hra' ? 2 : 1 }}" scope="col">
                                                        {{ pha_sub_software == 'hra' ? "Risk Rating" : 'Risk Assessment Matrix' }}
                                                    </th>

                                                    @* Implement 13 *@
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col" ng-if="flow_status != 14">
                                                        Implement
                                                    </th>
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col">
                                                        Remark
                                                    </th>
                                                    @* Hazop recommendations responded sheet 13 *@
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col" ng-if="flow_status != 14">
                                                        Hazop recommendations responded sheet
                                                    </th>
                                                    <th class="sort align-middle " colspan="2" rowspan="1" scope="col">
                                                        Recommendations Close Plan
                                                    </th>

                                                    <th class="sort align-middle " colspan="1" rowspan="3">
                                                        Over Due (Day)
                                                    </th>

                                                    <th class="sort align-middle " colspan="1" rowspan="3"></th>
                                                </tr>

                                                @*Review follow up*@
                                                <tr class="text-center table-bordered" ng-if="flow_status === 14">
                                                    <th class="sort align-middle " colspan="1" rowspan="3">
                                                        Recommen<br />dations No
                                                    </th>
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col">
                                                        {{pha_sub_software=='whatif'?'Task':'Node'}}
                                                    </th>
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col">
                                                        {{pha_sub_software=='whatif'?"What's if(Casuse)":'Casuse No'}}
                                                    </th>

                                                    @* Hazop recommendations responded sheet 14 *@
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col" ng-if="flow_status == 14">
                                                        Hazop recommendations responded sheet
                                                    </th>

                                                    @* Implement 14 *@
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col" ng-if="flow_status == 14">
                                                        Implement
                                                    </th>

                                                    @* Action Owner14 *@
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col" ng-if="flow_status == 14">
                                                        action owner responded
                                                    </th>

                                                    @* Status 14 *@
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col" ng-if="flow_status == 14">
                                                        Action<br />Status<br />(Items)
                                                    </th>

                                                    <th class="sort align-middle" colspan="2" rowspan="1" scope="col">
                                                        Risk Assessment Matrix
                                                    </th>

                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col">
                                                        Remark
                                                    </th>
                                                    @* Status 13 *@
                                                    @* <th class="sort align-middle " colspan="1" rowspan="3" scope="col" ng-if="!(flow_status == 13)">
                                                    Action<br />Status<br />(Items)
                                                    </th> *@
                                                    <th class="sort align-middle " colspan="2" rowspan="1" scope="col">
                                                        Recommendations Close Plan
                                                    </th>
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col" ng-if="!(flow_status == 13)">
                                                        Action Close Date
                                                    </th>
                                                    @* <th class="sort align-middle " colspan="1" rowspan="3" scope="col" ng-if="!(flow_status == 13)">
                                                    Action responded
                                                    </th> *@

                                                    <th class="sort align-middle " colspan="1" rowspan="3">
                                                        Over Due (Day)
                                                    </th>

                                                    <th class="sort align-middle " colspan="1" rowspan="3"></th>
                                                </tr>

                                                <tr class="text-center">
                                                    <th class="sort align-middle" scope="col" title="MITIGATED RISK ASSESSMENT MATRIX">
                                                        {{ pha_sub_software == 'hra' ? "Initial" : 'Before Action' }}
                                                    </th>
                                                    <th class="sort align-middle" scope="col">
                                                        {{ pha_sub_software == 'hra' ? "Residual" : 'After Action' }}
                                                    </th>
                                                    <th class="sort align-middle   bg-light-secondary" scope="col" rowspan="2" style="width:50%">
                                                        Start<br />Date
                                                    </th>
                                                    <th class="sort align-middle   bg-light-secondary" scope="col" rowspan="2" style="width:50%">
                                                        End<br />Date
                                                    </th>
                                                </tr>

                                                <tr class="text-center" ng-if="pha_sub_software !== 'hra'">
                                                    <th class="sort align-middle " scope="col">
                                                        <div class="d-flex ">
                                                            <div class="align-items-center ">
                                                                <p class="transition-none btn-reveal fs--2p-1 ps-0 text-center rounded-1" style="width: 20px; height:20px">
                                                                    S
                                                                </p>
                                                            </div>
                                                            <div class="align-items-center ">
                                                                <p class="transition-none btn-reveal fs--2p-1 ps-0 text-center rounded-1" style="width: 20px; height:20px">
                                                                    L
                                                                </p>
                                                            </div>

                                                            <div class="align-items-center ">
                                                                <p class="transition-none btn-reveal fs--2p-1 ps-0 text-center rounded-1" style="width: 20px; height:20px">
                                                                    R
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </th>

                                                    <th class="sort align-middle " scope="col">
                                                        <div class="d-flex ">
                                                            <div class="align-items-center ">
                                                                <p class="transition-none btn-reveal fs--2p-1 ps-0 text-center rounded-1" style="width: 20px; height:20px">
                                                                    S
                                                                </p>
                                                            </div>

                                                            <div class="align-items-center ">
                                                                <p class="transition-none btn-reveal fs--2p-1 ps-0 text-center rounded-1" style="width: 20px; height:20px">
                                                                    L
                                                                </p>
                                                            </div>

                                                            <div class="align-items-center ">
                                                                <p class="transition-none btn-reveal fs--2p-1 ps-0 text-center rounded-1" style="width: 20px; height:20px">
                                                                    R
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </th>
                                                </tr>

                                            </thead>

                                            <tbody class="list" id="customer-rating-table-body text-1100 ">
                                                <tr ng-repeat="item_d in data_details | filter: hasResponderUserDisplayName"
                                                    ng-init="accessInfo = Access_check(item)"
                                                    class="hover-actions-trigger btn-reveal-trigger position-static px-0 text-center">
                                                    <td class="align-top  px-1">
                                                        <div class="text-center">
                                                            <p class="mb-0 ms-3 fw-bold" style="width: 30px;" rows="3">
                                                                {{item_d.recommendations_no}} {{item_d.subarea_no}}
                                                            </p>
                                                        </div>
                                                    </td>

                                                    <td class="align-top  px-1">
                                                        <div class="d-flex text-start">
                                                            <p class="mb-0 ms-3 fw-bold" style="width: 30px;" rows="3">
                                                                {{item_d.node_no+'.'}} {{item_d.gruop_no}} {{item_d.hazard_no}}
                                                            </p>
                                                        </div>
                                                    </td>

                                                    <td class="align-top  px-1">
                                                        <div class="align-items-center ">
                                                            <p class="mb-0 ms-3 fw-bold" style="width: 30px;" rows="3">{{item_d.causes_no+'.'}}</p>
                                                        </div>
                                                    </td>

                                                    @* Hazop recommendations responded sheet 14 *@
                                                    <td class="align-top px-1" style="min-width:200px;" ng-if="flow_status == 14">
                                                        <div class=" p-0 cursor-pointer "
                                                             ng-repeat="item_x in data_drawingworksheet | filter:{id_worksheet:item_d.seq, action_type : '!delete'}">
                                                            <div class="d-flex align-items-center flex-nowrap"
                                                                 @* ng-if="!((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)" *@
                                                                 >
                                                                <div class="font-sans-serif btn-reveal-trigger position-static me-1">
                                                                    <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal fs--2 p-1"
                                                                            type="button" data-bs-toggle="dropdown" data-boundary="window"
                                                                            aria-haspopup="true" aria-expanded="false" data-bs-reference="parent">
                                                                        <span class="fas fa-cog text-info"></span>
                                                                    </button>
                                                                    <div class="dropdown-menu dropdown-menu-end py-2">
                                                                        <a class="dropdown-item text-success"
                                                                           ng-click=addDataWorksheetDrawing(item_x,item_d.seq)>
                                                                            <span class="fas fa-copy"></span>
                                                                            Add
                                                                        </a>
                                                                        <div class="dropdown-divider"></div>
                                                                        <a class="dropdown-item text-danger" ng-click=removeDataWorksheetDrawing(item_x,item_d.seq)>
                                                                            <span class="fas fa-times-circle"></span> Remove
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div class="align-items-center">
                                                                    <div class="btn-group mb-2" style="height:60px;">
                                                                        <div class="icon-button border p-3" style="border-color: #0d6efd; background-color: #0d6efd;">
                                                                            <span class="fa-solid fa-arrow-up-from-bracket fa-lg" style="color: #ffffff;"></span>
                                                                        </div>
                                                                        <button class="Upload-button btn ps-3" ng-if="!item_x.document_file_size">
                                                                            <label class="dz-message-text fw-bold cursor-pointer" for="attfile-{{item_x.seq}}" 
                                                                                   style="overflow: hidden; white-space: nowrap; text-overflow: ellipsis; max-width: 150px;">
                                                                                Upload File (Word, Excel, PDF, Image)
                                                                            </label>
                                                                            <input type="file" id="attfile-{{item_x.seq}}"
                                                                                   name="file{{item_x.seq}}"
                                                                                   onchange="
                                                                                angular.element(this).scope().fileSelect(this);"
                                                                                   ng-click="
                                                                                alert(item_x.seq);
                                                                                setSeqUpload(item_d.seq)"
                                                                                   style="display:none" />
                                                                        </button>
                                                                        <button class="Upload-button btn ps-3" ng-if="item_x.document_file_size > 0">
                                                                            <div class="d-flex align-items-center">
                                                                                <span class="mr-3 nametext"
                                                                                      id="filename{{item_x.seq}}"
                                                                                      
                                                                                      ng-click="downloadFile(item_x)"
                                                                                      ng-if="item_x.document_file_size>0">
                                                                                    <b style="font-size:x-small;">
                                                                                        {{truncateFilename(item_x.document_file_name, 20)}} ({{item_x.document_file_size}} KB)
                                                                                    </b>
                                                                                </span>
                                                                                <a id="deluploadfile-{{item_x.seq}}" 
                                                                                    ng-if="item_d.reviewer_action_type != 2"
                                                                                    class="btn btn-link text-danger p-0 ms-2"
                                                                                    ng-click="clearFileName(item_d.seq,item_x.seq)">
                                                                                    <span class="fa-regular fa-trash-can fa-lg"></span>
                                                                                </a>

                                                                            </div>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="text-start p-0 cursor-pointer d-flex flex-nowrap" ng-if="item_d.data_drawingworksheet_reviewer === 2">
                                                                <div ng-repeat="reviewer in data_drawingworksheet_reviewer">
                                                                    <a class="nametext ms-3 filename-text me-2" ng-if="flow_status == 14 && item_x.document_file_size > 0 && item_d.id === reviewer.id_worksheet" ng-click="downloadFile(item_x)">
                                                                        <i class="far fa-file-pdf text-danger"></i> {{ item_x.document_file_name }} ({{ item_x.document_file_size }}KB)
                                                                    </a>
                                                                </div>
                                                            </div>

                                                        </div>
                                                        <div id="valid-upload_file-{{item_d.seq}}" class="invalid-feedback text-danger text-start">
                                                            Please provide a valid Document file.
                                                        </div>
                                                    </td>

                                                    @* Implement 14 *@
                                                    <td class="align-top px-0" ng-if="flow_status == 14">
                                                        <div class="d-flex align-items-center justify-content-center position-relative" style="min-height: 52px;">
                                                            <input type="checkbox"
                                                                   ng-model="item_d.implement"
                                                                   style="cursor: not-allowed; width: 20px; height: 20px;">
                                                            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: not-allowed;"></div>
                                                        </div>
                                                    </td>


                                                    @* action owner responded 14 *@
                                                    <td class="align-top  px-1" ng-if="flow_status == 14">
                                                        <div class="align-items-center ">
                                                            <p class="mb-0 ms-3 fw-bold" style="width: 120px;">
                                                                {{item_d.responder_user_displayname}}
                                                            </p>
                                                            <a class="nametext ms-3 filename-text me-2" ng-if="flow_status == 14" ng-click="downloadFileOwner(item_d)">
                                                                <i class="far fa-file-pdf text-danger"></i> Document File
                                                            </a>
                                                            <p>{{item_d.responder_comment}}</p>
                                                        </div>
                                                    </td>

                                                    @* status 14 *@
                                                    <td class="align-top  px-1" ng-if="flow_status == 14">
                                                        <div class="align-items-start " style=" width: 95px;">
                                                            <select class="form-select form-select-sm p-1"
                                                                    ng-model="item_d.action_status"
                                                                    ng-change="actionChangedData(item_d)"
                                                                    ng-if="!((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)">
                                                                <option id="Open" ng-if="flow_status == 13">Open</option>
                                                                <option id="Responed">Responed</option>
                                                                <option id="Closed" ng-if="flow_status >= 14 || flow_role_type =='admin'">Closed</option>
                                                                <option id="Condition">Close with condition</option>
                                                            </select>

                                                            <textarea class="form-control form-control-sm rounded-1 p-0 mt-1 w-100 border border-end-0 border-top-0"
                                                                      style=" width: 100vh; font-size: 10px;"
                                                                      placeholder="Comment"
                                                                      rows="1"
                                                                      ng-model="item_d.reviewer_comment"
                                                                      ng-if="!((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)">
                                                            </textarea>

                                                            <div class="row" ng-if="((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)">
                                                                <h6><b>{{item_d.action_status}}</b></h6>
                                                                <p>Comment: {{item_d.reviewer_comment}}</p>
                                                            </div>
                                                            <div id="valid-comment-{{item_d.seq}}" class="invalid-feedback text-danger text-start">
                                                                Please provide a valid Comment file.
                                                            </div>
                                                        </div>

                                                    </td>

                                                    @* action owner 13 *@
                                                    <td class="align-top  px-1" ng-if="flow_status != 14">
                                                        <div class="align-items-center ">
                                                            <p class="mb-0 ms-3 fw-bold" style="width: 120px;">
                                                                {{item_d.responder_user_displayname}}
                                                            </p>
                                                            <a class="nametext ms-3 filename-text me-2" ng-if="flow_status == 14" ng-click="downloadFileOwner(item_d)">
                                                                <i class="far fa-file-pdf text-danger"></i> Document File
                                                            </a>
                                                        </div>
                                                    </td>

                                                    <td class="align-top  px-1" ng-if="flow_status != 14">
                                                        <div class="d-flex text-start">
                                                            <p class="mb-0 ms-3 fw-bold" style="width: 120px;" rows="3">
                                                                {{item_d.recommendations}}
                                                            </p>
                                                        </div>
                                                    </td>

                                                    @*Before action*@
                                                    <td class="align-top  px-1" ng-if="pha_sub_software !== 'hra'">
                                                        <div class="d-flex ">
                                                            <div class="align-items-center">
                                                                <h6 class="transition-none fs--2p-1 ps-0 text-center rounded-1 h-100 d-flex justify-content-center align-items-center"
                                                                    style="width: 20px;">
                                                                    {{item_d.ram_after_security}}
                                                                </h6><!--------------ng-click="openModalDataRAM('s',item_d,'after',item_d.id_ram,true)"-------------->
                                                            </div>

                                                            <div class="align-items-center">
                                                                <h6 class="transition-none fs--2p-1 ps-0 text-center rounded-1 h-100 d-flex justify-content-center align-items-center"
                                                                    style="width: 20px;">
                                                                    {{item_d.ram_after_likelihood}}
                                                                </h6><!------- ng-click="openModalDataRAM('l',item_d,'after',item_d.id_ram,true)"-------->
                                                            </div>

                                                            <div class="align-items-center text-end mt-1"
                                                                 ng-class="{ 'no-drop': !accessInfo.canAccess, 'cursor-pointer': accessInfo.canAccess }"
                                                                 style=" width: 30px;height:30px">
                                                                <button ng-style=" { 'background-color' : ((item_d.ram_after_risk == 'H') ? 'red' : ((item_d.ram_after_risk == 'M') ? 'yellow' : ((item_d.ram_after_risk == 'L') ? 'green' : '#D3D3D3')) ) }"
                                                                        class="btn btn-sm dropdown-toggle h-100 dropdown-caret-none transition-none btn-reveal fs--2p-1 ps-0 text-end"
                                                                        ng-class="{ 'cant-Access': !accessInfo.canAccess }"
                                                                        type="button"
                                                                        style="width: 30px;">
                                                                    <div class="d-flex text-center"
                                                                         style=" width: 25px;">
                                                                        <h6 class="me-1 text-center"
                                                                            style=" width: 30px;">
                                                                            {{item_d.ram_after_risk}}
                                                                        </h6>
                                                                        @*<span class="fas fa-pencil-alt fa-sm "
                                                                        style=" width: 8px;"></span>*@
                                                                    </div><!---ng-click="openModalDataRAM('r',item_d,'after',item_d.id_ram,true)"--->
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </td>

                                                    @*After action*@
                                                    <td class="align-top  px-1" ng-if="pha_sub_software !== 'hra'">
                                                        <div class="d-flex ">
                                                            <div class="align-items-center text-center">
                                                                <h6 class="transition-none fs--2p-1 ps-0 text-center rounded-1 h-100 d-flex justify-content-center align-items-center"
                                                                    ng-click="openModalDataRAM('s',item_d,'action',item_d.id_ram,false)"
                                                                    style="width: 20px;">
                                                                    {{item_d.ram_action_security}}
                                                                </h6>
                                                            </div>

                                                            <div class="align-items-center text-center">
                                                                <h6 class="transition-none fs--2p-1 ps-0 text-center rounded-1 h-100 d-flex justify-content-center align-items-center"
                                                                    ng-click="openModalDataRAM('l',item_d,'action',item_d.id_ram,false)"
                                                                    style="width: 20px;">
                                                                    {{item_d.ram_action_likelihood}}
                                                                </h6>
                                                            </div>
                                                            <div class="align-items-center text-end mt-1"
                                                                 ng-class="{ 'no-drop': !accessInfo.canAccess, 'cursor-pointer': accessInfo.canAccess }"
                                                                 style=" width: 30px;height:30px">
                                                                <button ng-style=" { 'background-color' : ((item_d.ram_action_risk == 'H') ? 'red' : ((item_d.ram_action_risk == 'M') ? 'yellow' : ((item_d.ram_action_risk == 'L') ? 'green' : '#D3D3D3')) ) }"
                                                                        class="btn btn-sm dropdown-toggle h-100 dropdown-caret-none transition-none btn-reveal fs--2p-1 ps-0 text-end"
                                                                        ng-class="{ 'cant-Access': !accessInfo.canAccess }"
                                                                        type="button"
                                                                        ng-click="openModalDataRAM('r',item_d,'action',item_d.id_ram,false)"
                                                                        style="width: 30px;">
                                                                    <div class="d-flex text-center"
                                                                         style=" width: 25px;">
                                                                        <h6 class="me-1 text-center"
                                                                            style=" width: 30px;">
                                                                            {{item_d.ram_action_risk}}
                                                                        </h6>
                                                                        <span class="fas fa-pencil-alt fa-sm " 
                                                                            ng-class="{'d-none': !accessInfo.isOwner && !accessInfo.isAdmin}"
                                                                            style=" width: 8px;">
                                                                        </span>
                                                                        <!-----ng-class="{ 'no-drop': !accessInfo.canAccess, 'cursor-pointer': accessInfo.canAccess }"------>
                                                                    </div>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </td>

                                                    @*Initial risk*@
                                                    <td class="align-top text-center" ng-if="pha_sub_software == 'hra'">
                                                        <div class="p-1 rounded-3" style="background-color: #ccffcc; color: #006600"><!--- ng-if="item.remaining > 3"---->
                                                            <h6 class="fw-semi-bold">{{item_d.initail_risk}}</h6>
                                                        </div>
                                                    </td>

                                                    @*Residual risk*@
                                                    <td class="align-top text-center" ng-if="pha_sub_software == 'hra'">
                                                        <div class="p-1 rounded-3" style="background-color: #ccffcc; color: #006600"><!--- ng-if="item.remaining > 3"--->
                                                            <h6 class="fw-semi-bold">{{item_d.residual_risk}}</h6>
                                                        </div>
                                                    </td>
                                                    @* Implement 13 *@
                                                    <td class="align-top px-0" ng-if="flow_status != 14">
                                                        <div class="d-flex justify-content-center align-items-center h-100 w-100 p-2">
                                                            <div class="m-auto" ng-class="{ 'no-drop': !accessInfo.canAccess, 'cursor-pointer': accessInfo.canAccess }">
                                                                <input type="checkbox" ng-model="item_d.implement"
                                                                       class="round-3"
                                                                       ng-class="{ 'cant-Access': !accessInfo.canAccess}"
                                                                       ng-click="actionImplement(item_d)"
                                                                       style="cursor: pointer; width: 20px; height: 20px;">
                                                            </div>
                                                        </div>
                                                    </td>

                                                    <td class="align-middle">
                                                        <div class="p-2" 
                                                            style="width: 200px;"
                                                            ng-hide="!(accessInfo.isOwner || accessInfo.isAdmin) && item_d.responder_action_type != 2">
                                                                <textarea class="form-control form-control-sm rounded-1 p-0 mt-1 w-100 border border-end-0 border-top-0"
                                                                    style="width: 100vh; font-size: 10px;"
                                                                    ng-attr-placeholder="{{ item_d.responder_action_type === 2 ? '' : 'Remark' }}"
                                                                    rows="3"
                                                                    ng-readonly="item_d.responder_action_type === 2"
                                                                    ng-change="actionInput(item_d)"
                                                                    ng-model="item_d.responder_comment">
                                                                </textarea>
                                                            <div id="valid-remark-{{item_d.seq}}"
                                                                 class="invalid-feedback text-danger">
                                                                Please provide a valid Remark.
                                                            </div>
                                                        </div>
                                                    </td>

                                                    @* Hazop recommendations responded sheet 13 *@
                                                    <td class="align-top px-1" style="min-width:200px;" ng-if="flow_status != 14">
                                                        <div class=" p-0 cursor-pointer "
                                                            ng-hide="!(accessInfo.isOwner || accessInfo.isAdmin)  && item_d.responder_action_type != 2"
                                                            ng-repeat="item_x in data_drawingworksheet | filter:{id_worksheet:item_d.seq, action_type : '!delete'}">
                                                            <div class="d-flex align-items-center flex-nowrap"
                                                                 ng-class="{ 'no-drop': !accessInfo.canAccess && !accessInfo.isAdmin, 'cursor-pointer': accessInfo.canAccess }">
                                                                <div class="font-sans-serif btn-reveal-trigger position-static me-1">
                                                                    <button class="btn p-1 text-danger"
                                                                            ng-click="openModalTempletes('pdf','item',item_d.seq)"
                                                                            ng-if="(accessInfo.canAccess || accessInfo.isAdmin) && $first"
                                                                            type="button" >
                                                                        <span class="fa-solid fa-file-lines"></span>
                                                                    </button>
                                                                    <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal fs--2 p-1"
                                                                            ng-if="accessInfo.canAccess || accessInfo.isAdmin"
                                                                            type="button" data-bs-toggle="dropdown" data-boundary="window"
                                                                            aria-haspopup="true" aria-expanded="false" data-bs-reference="parent">
                                                                        <span class="fas fa-cog text-info"></span>
                                                                    </button>
                                                                    <div class="dropdown-menu dropdown-menu-end py-2">
                                                                        <a class="dropdown-item text-success"
                                                                           ng-click=addDataWorksheetDrawing(item_x,item_d.seq)>
                                                                            <span class="fas fa-copy"></span>
                                                                            Add
                                                                        </a>
                                                                        <div class="dropdown-divider"></div>
                                                                        <a class="dropdown-item text-danger" ng-click=removeDataWorksheetDrawing(item_x,item_d.seq)>
                                                                            <span class="fas fa-times-circle"></span>
                                                                            Remove
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div class="align-items-center" style="width: 280px">
                                                                    <div class="btn-group mb-2 w-100" style="height:60px;">
                                                                        <div ng-if="!item_x.document_file_size" class="icon-button border p-3" style="border-color: #0d6efd; background-color: #0d6efd;">
                                                                            <span  class="fa-solid fa-arrow-up-from-bracket fa-lg" style="color: #ffffff;"></span>
                                                                        </div>
                                                                        <div ng-if="item_x.document_file_size" class="icon-button border p-3" style="border-color: #0d6efd; background-color: #0d6efd;">
                                                                            <span  class="fa-solid fa-file-pdf fa-lg" style="color: #ffffff;"></span>
                                                                        </div>

                                                                        <button class="Upload-button btn ps-3" ng-if="!item_x.document_file_size">
                                                                            <label class="dz-message-text fw-bold cursor-pointer" 
                                                                                for="attfile-{{item_x.seq}}" 
                                                                                style="overflow: hidden; white-space: nowrap; text-overflow: ellipsis; max-width: 150px;">
                                                                                Upload File
                                                                            </label>
                                                                            <input type="file" 
                                                                                id="attfile-{{item_x.seq}}"
                                                                                name="file{{item_x.seq}}"
                                                                                onchange="
                                                                                angular.element(this).scope().fileSelect(this);"
                                                                                ng-click="
                                                                                    alert(item_x.seq);
                                                                                    setSeqUpload(item_d.seq)"
                                                                                style="display:none" />
                                                                        </button>
                                                                        
                                                                        <button class="Upload-button btn ps-3" ng-if="item_x.document_file_size > 0">
                                                                            <div class="d-flex align-items-center">
                                                                                <span class="mr-3 nametext"
                                                                                      id="filename{{item_x.seq}}"
                                                                                      ng-click="downloadFile(item_x)"
                                                                                      ng-if="item_x.document_file_size>0">
                                                                                    <b style="font-size:x-small;">
                                                                                        {{truncateFilename(item_x.document_file_name, 20)}} ({{item_x.document_file_size}} KB)
                                                                                    </b>
                                                                                </span>
                                                                                <a id="deluploadfile-{{item_x.seq}}" class="btn btn-link text-danger p-0 ms-2" 
                                                                                    ng-click="clearFileName(item_d.seq, item_x.seq)">
                                                                                    <span class="fa-regular fa-trash-can fa-lg"
                                                                                        ng-class="{'d-none': item_d.responder_user_name != user_name}">
                                                                                    </span>
                                                                                </a>
                                                                            </div>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            @* <div class="text-start p-0 cursor-pointer d-flex flex-nowrap" ng-if="item_d.responder_action_type === 2">
                                                                <div ng-repeat="responder in data_drawingworksheet_responder">
                                                                    <a class="nametext ms-3 filename-text me-2" ng-if="flow_status == 13 && item_x.document_file_size > 0 && item_d.id === responder.id_worksheet" ng-click="downloadFile(item_x)">
                                                                        <i class="far fa-file-pdf text-danger"></i> {{ item_x.document_file_name }} ({{ item_x.document_file_size }}KB)
                                                                    </a>
                                                                </div>
                                                            </div> *@
                                                        </div>
                                                        <div id="valid-upload_file-{{item_d.seq}}" class="invalid-feedback text-danger text-start">
                                                            Please provide a valid Document file.
                                                        </div>
                                                    </td>

                                                    @* status 13 *@

                                                    <td class="align-middle  px-0" style=" width: 70px;">
                                                        <div class="align-items-center ">
                                                            <p><b>{{item_d.estimated_start_date_text}}</b></p>
                                                        </div>
                                                    </td>

                                                    <td class="align-middle  px-0" style=" width: 70px;">
                                                        <div class="align-items-center ">
                                                            <p><b>{{item_d.estimated_end_date_text}}</b></p>
                                                        </div>
                                                    </td>

                                                    <td class="align-middle  px-0" style=" width: 70px;" ng-if="!(flow_status == 13)">
                                                        <div class="align-items-center ">
                                                            <p><b>{{item_d.reviewer_date}}</b></p>
                                                        </div>
                                                    </td>

                                                    <td class="align-middle  px-0">
                                                        <div class="align-items-center ">
                                                            <p class="text-danger"><b>{{item_d.over_due}}</b></p>
                                                        </div>
                                                    </td>


                                                    <td class="align-top px-0 pt-0 ">
                                                        <div class="d-flex" 
                                                            ng-hide="!(accessInfo.isOwner || accessInfo.isAdmin)  && data_general[0].pha_status == 13"
                                                            ng-class="{ 
                                                                'no-drop': !accessInfo.canAccess && !accessInfo.isAdmin, 'cursor-pointer': accessInfo.canAccess}">
                                                            <button class="btn btn-outline text-primary p-1 m-2 me-0"
                                                                    ng-class="{ 'cant-Access': !(accessInfo.isOwner || accessInfo.isAdmin) }"
                                                                    style="background-color: #f1f2f4; width: 50px;"
                                                                    ng-click="actionSave(item_d)"
                                                                    ng-if="!((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)">
                                                                <span class="fa fa-save text-primary fa-lg"></span><br />
                                                                <span style="font-size: 8px">Save</span>
                                                            </button>

                                                            <button class="btn btn-outline text-success p-1 m-2 ms-1"
                                                                    ng-class="{ 'cant-Access': !(accessInfo.isOwner || accessInfo.isAdmin) }"
                                                                    style="background-color: #f1f2f4; width: 80px;"
                                                                    ng-click="showConfirmDialogSubmit(item_d, 'submit')"
                                                                    ng-if="!((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)">
                                                                <span class="fa fa-save text-success fa-lg"></span><br />
                                                                <span style="font-size: 8px">
                                                                    {{ flow_status == 14 ? 'Approve and Close' : 'Submit to Reviewer' }}
                                                                </span>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>


                                        @* เนื่องจากโครงสร้างตาราง ต่างจาก hazop และ what's if   *@
                                        <table ng-if="(pha_sub_software == 'hra')" class="table fs--2 mb-0 table-bordered " cellpadding="0" cellspacing="0">
                                            <thead class="text-uppercase  bg-light-secondary">

                                                @*follow up*@
                                                <tr class="text-center" >
                                                    <th class="sort align-middle" colspan="1" rowspan="3">
                                                        Job Type/Change Type
                                                    </th>
                                                    <th class="sort align-middle" colspan="1" rowspan="3" scope="col">
                                                        Task or Activity
                                                    </th>
                                                    <th class="sort align-middle" colspan="1" rowspan="3" scope="col">
                                                        Sub Area
                                                    </th>

                                                    @* Exposure Indicator => Type of Hazard - Health Hazard or Risk Factor*@
                                                    <th class="sort align-middle" colspan="2" rowspan="1" scope="col">
                                                        Exposure Indicator
                                                    </th>
                                                    @* Health Effect Rating *@
                                                    <th class="sort align-middle" colspan="1" rowspan="3" scope="col" ">
                                                        Health Effect Rating
                                                    </th>
                                                    @* Risk Rating => Initial Risk Rating - Residual Risk Rating *@
                                                    <th class="sort align-middle" colspan="2" rowspan="1" scope="col" ">
                                                        Risk Rating
                                                    </th>

                                                    @* Recommendations *@
                                                    <th class="sort align-middle " colspan="1" rowspan="3">
                                                        Action Owner responded
                                                    </th>
                                                    @* Action Owner 13 *@
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col" ng-if="flow_status == 13">
                                                        Action Owner
                                                    </th>

                                                    @* Recommendations responded sheet -> Status 13 *@
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col">
                                                        Recommendations responded sheet
                                                    </th>

                                                    @* Action Type status  *@
                                                    <th class="sort align-middle " colspan="1" rowspan="3" scope="col" ng-if="flow_status == 14">
                                                        Action<br />Status<br />(Items)
                                                    </th>

                                                    @* Recommendations Close Plan  *@
                                                    <th class="sort align-middle " colspan="2" rowspan="1" scope="col">
                                                        Recommendations Close Plan
                                                    </th>

                                                    @* <th class="sort align-middle " colspan="1" rowspan="3">
                                                        Over Due (Day)
                                                    </th> *@

                                                    <th class="sort align-middle " colspan="1" rowspan="3"></th>
                                                </tr>
                                                <tr class="text-center">
                                                    @* Exposure Indicator => Type of Hazard - Health Hazard or Risk Factor*@
                                                    <th class="sort align-middle" scope="col" rowspan="2" title="Type of Hazard">
                                                        Type of Hazard
                                                    </th>
                                                    <th class="sort align-middle" scope="col" rowspan="2" title="Health Hazard or Risk Factor">
                                                        Health Hazard or Risk Factor
                                                    </th>

                                                    @* Risk Rating => Initial Risk Rating - Residual Risk Rating *@
                                                    <th class="sort align-middle" scope="col" rowspan="2" title="Initial Risk Rating">
                                                        Initial Risk Rating
                                                    </th>
                                                    <th class="sort align-middle" scope="col" rowspan="2" title="Residual Risk Rating">
                                                        Residual Risk Rating
                                                    </th>

                                                    @* Recommendations Close Plan *@
                                                    <th class="sort align-middle   bg-light-secondary" scope="col" rowspan="2" style="width:50%">
                                                        Start<br />Date
                                                    </th>
                                                    <th class="sort align-middle   bg-light-secondary" scope="col" rowspan="2" style="width:50%">
                                                        End<br />Date
                                                    </th>
                                                </tr>


                                            </thead>

                                            <tbody class="list" id="customer-rating-table-body text-1100 ">
                                                <tr ng-repeat="item_d in data_details"
                                                    ng-init="accessInfo.canAccess = Access_check(item_d)"
                                                    class="hover-actions-trigger btn-reveal-trigger position-static px-0 text-center">
                                                    <td class="align-top  px-1">
                                                        <div class="text-center"  style="width: 70px !important;">
                                                            <p class="mb-0 ms-3 fw-bold"  rows="3">
                                                                {{ item_d.worker_group ? item_d.worker_group : 'Not found' }}
                                                            </p>
                                                        </div>
                                                    </td>

                                                    @* Task or Activity *@
                                                    <td class="align-top  px-1">
                                                        <div class="d-flex text-start">
                                                            <p class="mb-0 ms-3 fw-bold" rows="3">
                                                                {{ item_d.descriptions ? item_d.descriptions : 'Not found' }}
                                                            </p>
                                                        </div>
                                                    </td>

                                                    <td class="align-top  px-1">
                                                        <div class="align-items-center ">
                                                            <p class="mb-0 ms-3 fw-bold" style="width: 30px;" rows="3">
                                                                {{ item_d.sub_area ? item_d.sub_area : 'Not found' }}
                                                            </p>
                                                        </div>
                                                    </td>
                                                    <td class="align-top  px-1">
                                                        <div class="align-items-center ">
                                                            <p class="mb-0 ms-3 fw-bold" style="width: 30px;" rows="3">
                                                                {{ item_d.type_hazard ? item_d.type_hazard : 'Not found' }}
                                                            </p>
                                                        </div>
                                                    </td>
                                                    <td class="align-middle  px-1">
                                                        <div class="align-items-center ">
                                                            <p class="mb-0 ms-3 fw-bold" style="width: 80px;" rows="3">
                                                                {{ item_d.riskfactors ? item_d.riskfactors : 'Not found' }}
                                                            </p>
                                                        </div>
                                                    </td>

                                                    <td class="align-middle  px-1">
                                                        <div class="align-items-center ">
                                                            <div class="fw-bold">
                                                                {{ item_d.health_effect_rating ? item_d.health_effect_rating : 'Not found' }}
                                                            </div>
                                                        </div>
                                                    </td>

                                                    @*Initial risk*@
                                                    <td class="align-middle">
                                                        <div class="card-initial " 
                                                             style="width: 80px;"
                                                             ng-class="{
                                                                'risk-acceptable': (item_d.initial_risk_rating == 'Acceptable Risk' || item_d.initial_risk_rating == 'Acceptable Risk\r\n'),
                                                                'risk-low': (item_d.initial_risk_rating == 'Low' || item_d.initial_risk_rating == 'Low\r\n'),
                                                                'risk-medium': (item_d.initial_risk_rating == 'Meduim' || item_d.initial_risk_rating == 'Meduim\r\n'),
                                                                'risk-high': (item_d.initial_risk_rating == 'High' || item_d.initial_risk_rating == 'High\r\n'),
                                                                'risk-very-high': (item_d.initial_risk_rating == 'Very High' || item_d.initial_risk_rating == 'Very High\r\n')}">
                                                            <div class="">
                                                                {{item_d.initail_risk}}
                                                            </div>
                                                        </div>
                                                    </td>

                                                    @*Residual risk*@
                                                    <td class="align-middle text-center">
                                                        <div class="" 
                                                            style="width: 90px;"
                                                            ng-if="!((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2) && accessInfo.canAccess">
                                                            {{reviewer_action_type}}
                                                            <select class="form-select form-select-sm rounded-1 p-2" 
                                                                ng-model="item_d.residual_risk" 
                                                                ng-change="actionChangedRisk(item_d)"
                                                                style=" min-width: 60px; font-size: 10.24px;">
                                                                @* <option value="" selected>Please select</option> *@
                                                                <option value="Low">Low</option>
                                                                <option value="Meduim" >Meduim</option>
                                                                <option value="High" >High</option>
                                                            </select>
                                                        </div>      
                                                        <!---ng-if="item_d.action_status !== 'Closed' || (item_d.action_status === 'Responed' && !accessInfo.canAccess)"---->
                                                        <div class="p-1 rounded-3 m-auto" 
                                                            style="width: 80px;"
                                                            ng-if="((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)"
                                                            ng-class="{
                                                                'bg-danger': (item_d.residual_risk == 'High' || item_d.residual_risk == 'High\r\n'), 
                                                                'bg-warning': (item_d.residual_risk == 'Meduim' || item_d.residual_risk == 'Meduim\r\n'),
                                                                'bg-success': (item_d.residual_risk == 'Low' || item_d.residual_risk == 'Low\r\n') }">
                                                            <h6 class="fw-semi-bold text-white">{{item_d.residual_risk}}</h6>
                                                        </div>
                                                    </td>

                                                    @* Recommendations*@
                                                    <td class="align-middle px-1" ng-if="flow_status != 14">
                                                        <div class="text-center" style="width: 140px;">
                                                            <p class="mb-0 fw-bold">
                                                                {{item_d.recommendations}}
                                                            </p>
                                                        </div>
                                                    </td>

                                                    @* action owner responded => status 13 *@
                                                    <td class="align-middle px-1" ng-if="flow_status != 14">
                                                        <div class="align-items-center ">
                                                            <p class="mb-0 fw-bold" style="width: 120px;">
                                                                {{item_d.responder_user_displayname}}
                                                            </p>
                                                            <a class="nametext filename-text" ng-if="flow_status == 14" ng-click="downloadFileOwner(item_d)">
                                                                <i class="far fa-file-pdf text-danger"></i> Document File
                                                            </a>
                                                        </div>
                                                    </td>

                                                    @* Recommendations responded sheet  => status 13 *@
                                                    <td class="align-middle px-1" style="min-width:200px;" ng-if="flow_status != 14">
                                                        <div class=" p-0 cursor-pointer "
                                                             ng-repeat="item_x in data_drawingworksheet | filter:{id_worksheet:item_d.seq, action_type : '!delete'}">
                                                            <div class="d-flex align-items-center flex-nowrap"
                                                                 ng-class="{ 'no-drop': !accessInfo.canAccess, 'cursor-pointer': accessInfo.canAccess }"
                                                                 ng-if="!((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)">
                                                                <div class="font-sans-serif btn-reveal-trigger position-static me-1">
                                                                    <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal fs--2 p-1"
                                                                            ng-class="{ 'cant-Access': !accessInfo.canAccess }"
                                                                            ng-hide="!accessInfo.canAccess"
                                                                            type="button" data-bs-toggle="dropdown" data-boundary="window"
                                                                            aria-haspopup="true" aria-expanded="false" data-bs-reference="parent">
                                                                        <span class="fas fa-cog text-info"></span>
                                                                    </button>
                                                                    <div class="dropdown-menu dropdown-menu-end py-2">
                                                                        <a class="dropdown-item text-success"
                                                                           ng-click=addDataWorksheetDrawing(item_x,item_d.seq)>
                                                                            <span class="fas fa-copy"></span>
                                                                            Add
                                                                        </a>
                                                                        <div class="dropdown-divider"></div>
                                                                        <a class="dropdown-item text-danger" ng-click=removeDataWorksheetDrawing(item_x,item_d.seq)>
                                                                            <span class="fas fa-times-circle"></span>
                                                                            Remove
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                                <div class="align-items-center" style="width: 280px">
                                                                    <div class="btn-group my-2 w-100" >
                                                                        <div class="icon-button border p-3" style="border-color: #0d6efd; background-color: #0d6efd;"
                                                                            ng-hide="!accessInfo.canAccess">
                                                                            <span class="fa-solid fa-arrow-up-from-bracket fa-lg" style="color: #ffffff;"></span>
                                                                        </div>
                                                                        <button class="Upload-button btn ps-3" 
                                                                                ng-hide="!accessInfo.canAccess"
                                                                                style="width:240px;"
                                                                                ng-style="{ 'background-color': accessInfo.canAccess ? '' : '#f5f7fa' }"
                                                                                ng-class="{ 'no-drop': !accessInfo.canAccess, 'cursor-pointer': accessInfo.canAccess }" 
                                                                                ng-if="!item_x.document_file_size">
                                                                            <span class="nametext ms-3 filename-text me-2 d-none" id="filename-approver-{{item_x.seq}}">
                                                                                {{(item_x.document_file_size>0? item_x.document_file_name + '('+  item_x.document_file_size + 'KB)' : '')}}
                                                                            </span>
                                                                            <label class="dz-message-text fw-bold p-1 " for="attfile-{{item_x.seq}}"
                                                                                ng-class="{ 'no-drop': !accessInfo.canAccess, 'cursor-pointer': accessInfo.canAccess }"
                                                                                ng-style="{ 'background-color': accessInfo.canAccess ? '' : '#f5f7fa' }">
                                                                                Upload File
                                                                            </label>
                                                                            <input type="file" id="attfile-{{item_x.seq}}"
                                                                                name="file{{item_x.seq}}"
                                                                                ng-class="{ 'disabled-link': !accessInfo.canAccess, 'cursor-pointer' : accessInfo.canAccess }"
                                                                                ng-disabled="!accessInfo.canAccess"
                                                                                onchange="angular.element(this).scope().fileSelect(this)"
                                                                                ng-click="setSeqUpload(item_d.seq)"
                                                                                style="display:none" />
                                                                        </button>
                                                                        <button class="Upload-button btn cursor-pointer" style="width:240px;" 
                                                                            ng-hide="!accessInfo.canAccess"
                                                                            ng-if="item_x.document_file_size > 0">
                                                                            <div class="d-flex align-items-center" >
                                                                                <span class="nametext filename-text me-2 cursor-pointer">
                                                                                    {{ item_x.document_file_name }} ({{ item_x.document_file_size }} KB)
                                                                                </span>
                                                                            </div>
                                                                        </button>
                                                                    </div>   
                                                                </div>
                                                            </div>
                                                            <div class="ursor-pointer d-flex justify-content-center flex-nowrap">
                                                                <div ng-repeat="responder in data_drawingworksheet_responder">
                                                                    <a class="nametext filename-text" 
                                                                        ng-if="item_x.document_file_size > 0 && item_d.id === responder.id_worksheet && responder.seq === item_x.id" 
                                                                        ng-click="downloadFile(item_x)">
                                                                        <i class="far fa-file-pdf text-danger"></i> 
                                                                        {{ item_x.document_file_name }} ({{ item_x.document_file_size }}KB)
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        @*<div id="valid-upload_file-{{item_d.seq}}" class="invalid-feedback text-danger text-start">
                                                            Please provide a valid Document file.
                                                        </div>*@
                                                    </td>

                                                    @* action owner responded => status 14 *@
                                                    <td class="align-top  px-1" ng-if="flow_status == 14">
                                                        <div class="align-items-center ">
                                                            <p class="mb-0 ms-3 fw-bold" style="width: 120px;">
                                                                {{item_d.responder_user_displayname}}
                                                            </p>
                                                            <a class="nametext ms-3 filename-text me-2" ng-if="flow_status == 14" ng-click="downloadFileOwner(item_d)">
                                                                <i class="far fa-file-pdf text-danger"></i> Document File
                                                            </a>
                                                            <p>{{item_d.responder_comment}}</p>
                                                        </div>
                                                    </td>

                                                    @* Recommendations responded sheet => status 14 *@
                                                    <td class="align-top px-1" style="min-width:200px;" ng-if="flow_status == 14">
                                                        <div class=" p-0 cursor-pointer "
                                                             ng-repeat="item_x in data_drawingworksheet | filter:{id_worksheet:item_d.seq, action_type : '!delete'}">
                                                            <div class="d-flex flex-nowrap"
                                                                 ng-if="!((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)">
                                                                <div class="d-flex align-items-center font-sans-serif btn-reveal-trigger position-static me-1">
                                                                    <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal fs--2 p-1"
                                                                            type="button" data-bs-toggle="dropdown" data-boundary="window"
                                                                            aria-haspopup="true" aria-expanded="false" data-bs-reference="parent">
                                                                        <span class="fas fa-cog text-info"></span>
                                                                    </button>
                                                                    <div class="dropdown-menu dropdown-menu-end py-2">
                                                                        <a class="dropdown-item text-success"
                                                                           ng-click=addDataWorksheetDrawing(item_x,item_d.seq)>
                                                                            <span class="fas fa-copy"></span>
                                                                            Add
                                                                        </a>
                                                                        <div class="dropdown-divider"></div>
                                                                        <a class="dropdown-item text-danger" ng-click=removeDataWorksheetDrawing(item_x,item_d.seq)>
                                                                            <span class="fas fa-times-circle"></span> Remove
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                                <div class="align-items-center">
                                                                    <div class="btn-group my-2" ng-style="{ 'opacity': !accessInfo.canAccess ? 0.5 : 1}"
                                                                        ng-hide="!accessInfo.canAccess"
                                                                        ng-class="{ 'no-drop': !accessInfo.canAccess, 'ps-2': !accessInfo.canAccess, 'cursor-pointer': accessInfo.canAccess }">
                                                                        <div class="icon-button border p-3" style="border-color: #0d6efd; background-color: #0d6efd;"
                                                                            ng-style="{ 'opacity': !accessInfo.canAccess ? 0.5 : 1}" ng-hide="!accessInfo.canAccess && !item_x.document_file_size">
                                                                            <span class="fa-solid fa-arrow-up-from-bracket fa-lg" style="color: #ffffff;"></span>
                                                                        </div>
                                                                        <button class="Upload-button btn ps-3" 
                                                                            style="width:240px;"
                                                                            ng-style="{ 'background-color': accessInfo.canAccess ? '' : '#f5f7fa' }"
                                                                            ng-class="{ 'no-drop': !accessInfo.canAccess, 'cursor-pointer': accessInfo.canAccess }" 
                                                                            ng-if="!item_x.document_file_size">
                                                                            <span class="nametext ms-3 filename-text me-2 d-none" id="filename-approver-{{item_x.seq}}">
                                                                                {{(item_x.document_file_size>0? item_x.document_file_name + '('+  item_x.document_file_size + 'KB)' : '')}}
                                                                            </span>
                                                                            <label class="dz-message-text fw-bold p-1 " for="attfile-{{item_x.seq}}"
                                                                                ng-class="{ 'no-drop': !accessInfo.canAccess, 'cursor-pointer': accessInfo.canAccess }"
                                                                                ng-style="{ 'background-color': accessInfo.canAccess ? '' : '#f5f7fa' }">
                                                                                Upload File 
                                                                            </label><!---(Word, Excel, PDF, Image)----->
                                                                            <input type="file" id="attfile-{{item_x.seq}}"
                                                                                name="file{{item_x.seq}}"
                                                                                ng-class="{ 'disabled-link': !accessInfo.canAccess, 'cursor-pointer' : accessInfo.canAccess }"
                                                                                ng-disabled="!accessInfo.canAccess"
                                                                                onchange="angular.element(this).scope().fileSelect(this)"
                                                                                ng-click="setSeqUpload(item_d.seq)"
                                                                                style="display:none" />

                                                                        </button>
                                                                        <button class="Upload-button btn cursor-pointer" style="width:240px;" ng-if="item_x.document_file_size > 0">
                                                                            <div class="d-flex align-items-center">
                                                                                <span class="nametext filename-text me-2 cursor-pointer">
                                                                                    {{ item_x.document_file_name }} ({{ item_x.document_file_size }} KB)
                                                                                </span>
                                                                            </div>
                                                                        </button>
                                                                    </div>                                                                       
                                                                </div>
                                                            </div>

                                                            <div class="text-start p-0 cursor-pointer d-flex flex-nowrap">
                                                                <div ng-repeat="reviewer in data_drawingworksheet_reviewer">
                                                                    <a class="nametext ms-3 filename-text me-2" 
                                                                        ng-if="flow_status == 14 && item_x.document_file_size > 0 
                                                                        && item_d.id === reviewer.id_worksheet  && reviewer.seq === item_x.id" ng-click="downloadFile(item_x)">
                                                                        <i class="far fa-file-pdf text-danger"></i> 
                                                                        {{ item_x.document_file_name }} ({{ item_x.document_file_size }}KB)
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        @*<div id="valid-upload_file-{{item_d.seq}}" class="invalid-feedback text-danger text-start">
                                                            Please provide a valid Document file.
                                                        </div>*@
                                                    </td>


                                                    @* Action Type status  => status 14 *@
                                                    <td class="align-top  px-1" ng-if="flow_status == 14">
                                                        <div class="align-items-start " style=" width: 95px;"
                                                            ng-class="{ 'no-drop': !accessInfo.canAccess, 'cursor-pointer': accessInfo.canAccess }">
                                                            <select class="form-select form-select-sm p-1"
                                                                    ng-model="item_d.action_status"
                                                                    ng-change="actionChangedData(item_d)"
                                                                    ng-disable="!accessInfo.canAccess"
                                                                    ng-if="!((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)">
                                                                <option id="Open" ng-if="flow_status == 13">Open</option>
                                                                <option id="Responed">Responed</option>
                                                                <option id="Closed" ng-if="flow_status >= 14 || flow_role_type =='admin'">Closed</option>
                                                                <option id="Condition">Close with condition</option>
                                                            </select>

                                                            <textarea class="form-control form-control-sm rounded-1 p-0 mt-1 w-100 border border-end-0 border-top-0"
                                                                style=" width: 100vh; font-size: 10px;"
                                                                placeholder="Comment"
                                                                rows="1"
                                                                ng-disable="!accessInfo.canAccess"
                                                                ng-model="item_d.reviewer_comment"
                                                                ng-if="!((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)">
                                                            </textarea>

                                                            <div class="row" ng-if="((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)">
                                                                <h6><b>{{item_d.action_status}}</b></h6>
                                                                <p ng-if="item_d.reviewer_comment">Comment: <span>{{item_d.reviewer_comment}}</span></p>
                                                            </div>
                                                            <div id="valid-comment-{{item_d.seq}}" class="invalid-feedback text-danger text-start">
                                                                Please provide a valid Comment file.
                                                            </div>
                                                        </div>

                                                    </td>


                                                    @* Recommendations Close Plan*@
                                                    <td class="align-middle  px-0" style=" width: 70px;">
                                                        <b>{{item_d.estimated_start_date_text}}</b>
                                                    </td>

                                                    <td class="align-middle  px-0" style=" width: 70px;">
                                                        <b>{{item_d.estimated_end_date_text}}</b>
                                                    </td>

                                                    @* <td class="align-middle  px-0" style=" width: 70px;" ng-if="!(flow_status == 13)">
                                                        <b>{{item_d.reviewer_date}}</b>
                                                    </td> *@

                                                    @* <td class="align-middle  px-0">
                                                        <div class="text-danger"><b>{{item_d.over_due}}</b></div>
                                                    </td> *@

                                                    <td class="align-middle px-0 pt-0 ">
                                                        <div class="d-flex" ng-class="{ 'no-drop': !accessInfo.canAccess, 'cursor-pointer': accessInfo.canAccess}">
                                                            <button class="btn btn-outline text-primary  p-1 m-2 me-0"
                                                                style=" background-color: #f1f2f4; width:50px;"
                                                                ng-click="actionSave(item_d)"
                                                                ng-hide="!accessInfo.canAccess"
                                                                ng-if="!((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)">
                                                                <span class="fa fa-save text-primary fa-lg"></span><br />
                                                                <span style="font-size:8px">Save</span>
                                                            </button>
                                                            <button class="btn btn-outline text-success  p-1 m-2 ms-1"
                                                                style="background-color: #f1f2f4; width:80px; "
                                                                ng-click="showConfirmDialogSubmit(item_d,'submit')"
                                                                ng-hide="!accessInfo.canAccess"
                                                                ng-if="!((flow_status == 14 ? item_d.reviewer_action_type : item_d.responder_action_type) == 2)">
                                                                <span class="fa fa-save text-success fa-lg"></span><br />
                                                                <span style="font-size:8px">
                                                                    {{flow_status == 14 ?'Approve and Close' : 'Submit to Reviewer' }}
                                                                </span>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>



                                        <div class="d-flex align-items-center jujustify-content-end py-4 text-primary" style="cursor: pointer;" ">
                                            <span class="fa-solid far fa-file-pdf text-danger p-2" ng-if="pha_sub_software == 'hazop' || pha_sub_software == 'whatif'" ng-click="openModalTempletes()"></span>
                                            <a ng-if="pha_sub_software == 'hazop'" ng-click="openModalTempletes('pdf','owner')">Please attach HAZOP Recommendation worksheet (QMTS-SFR-25) with line manager/MOC focal point signature</a>
                                            <a ng-if="pha_sub_software == 'whatif'" ng-click="openModalTempletes('pdf','owner')">Please attach What's If Recommendation worksheet with line manager/MOC focal point signature</a>
                                        </div>
                                    </div>

                                    <div class="d-none" ng-if="(flow_status >= 13 && flow_role_type =='admin')">
                                        <label class="form-label ps-0" for="description_general">Comment :</label>
                                        <label class="form-label ps-0" ng-if="select_history_tracking_record">
                                            <a class="form-label far fa-comment-alt text-warning cursor-pointer"
                                               data-bs-toggle="tooltip"
                                               data-bs-placement="top"
                                               title=""
                                               data-bs-html="true">
                                            </a>
                                        </label>
                                        <textarea class="form-control rounded-1" ng-class="{'disabled-link':(!tab_general_active)}"
                                            id="review_folow_comment"
                                            name="review_folow_comment"
                                            placeholder="Comment"
                                            style="height: 100px"
                                            ng-model="data_general[0].review_folow_comment"
                                            ng-change="actionChangedDataComment(data_general[0])">
                                        </textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    @* Modal RAM Start *@
    <div class="modal fade modal-xl shadow-sm p-3 mb-5  rounded" id="modalRAM" tabindex="-1"
         aria-labelledby="modalRAMLabel" aria-hidden="true" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">

            <div class="modal-content">
                <div class="modal-header">

                    <h5 class="modal-title" id="modalRAMLabel">
                        Risk Assessment Matrix
                        (RAM){{(selectedDataNodeWorksheetRamType =='s'?' : Security':(selectedDataNodeWorksheetRamType
                        =='l'?' : Likelihood':''))}}
                    </h5>


                    <div class="col-auto ms-auto" style="zoom:1.5">
                        <b class="pe-1 me-1"> Security : {{cal_ram_action_security}}</b>
                        <b class="pe-1 me-1"> Likelihood : {{cal_ram_action_likelihood}}</b>
                        <b class="pe-1 me-1"> Risk : </b>
                        <label class="pe-1 me-1 text-center" style="width:100px"
                               ng-style=" { 'background-color' : ((cal_ram_action_risk == 'H') ? 'red' : ((cal_ram_action_risk == 'M') ? 'yellow' : ((cal_ram_action_risk == 'L') ? 'green' : '#D3D3D3')) ) }">{{cal_ram_action_risk}}</label>
                    </div>

                    <button class="btn p-1" type="button" data-bs-dismiss="modal" aria-label="Close" ng-click="closeModalDataRAM_Worksheet()">
                        <svg class="svg-inline--fa fa-xmark fs--1" aria-hidden="true" focusable="false" data-prefix="fas"
                             data-icon="xmark" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"
                             data-fa-i2svg="">
                            <path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z">
                            </path>
                        </svg>
                    </button>

                </div>

                <div class="modal-body  ">

                    <div class="row" ng-if="data_details[0].id_ram==5">
                        <div class="row">
                            <div class="col-1"></div>
                            <div class="col-5 d-flex justify-content-start gap-10">
                                <span class="mx-1 d-flex pt-5">
                                    <a class="m-1 text-info cursor-pointer" href="{{y.document_definition_file_path}}"
                                       target="_blank"
                                       ng-repeat="y in master_ram | filter:{id: data_details[0].id_ram}">
                                        Definition
                                        Consequence Rating<span class="fas fa-file-pdf fa-lg ms-1"></span>
                                    </a>
                                </span>
                            </div>
                            <div class="col-5 d-flex justify-content-center" style="padding: 10px 10px;gap: 65px;">
                                <div class="d-flex justify-content-end align-items-center flex-column"
                                     ng-repeat="item_ram in master_likelihood_level | filter:{id_ram:data_details[0].id_ram,columns_level:item_ram.columns_level}">
                                    <label for="likelihood"><b>{{item_ram.likelihood_level}}</b></label>
                                    <input type="radio"
                                           id="likelihood"
                                           name="likelihood"
                                           ng-checked="cal_ram_action_likelihood == item_ram.likelihood_level"
                                           ng-click="selectDataRAM('l',item_ram.likelihood_level)"
                                           style="cursor: pointer; width:25px; height:25px;">
                                </div>
                            </div>
                            <div class="col-1 d-flex justify-content-end"></div>
                        </div>

                        <div class="col-1 d-flex flex-column justify-content-end"
                             style="gap: 40px; padding: 0px;  padding-bottom: 20px;">
                            <div class="d-flex justify-content-end align-items-center gap-2"
                                 ng-repeat="item_ram in master_security_level | filter:{id_ram:data_details[0].id_ram,category_type:item_ram.category_type}">
                                <label for="security_level"><b>{{item_ram.security_level}}</b></label>
                                <input type="radio"
                                       id="security_level"
                                       name="security_level"
                                       ng-checked="cal_ram_action_security == item_ram.security_level"
                                       ng-click="selectDataRAM('s',item_ram.security_level)"
                                       style="cursor: pointer; width:25px; height:25px;">
                            </div>
                        </div>

                        <div class="col-11">
                            <div class="cursor-pointer "
                                 ng-repeat="itemRam in master_ram | filter:{id: data_details[0].id_ram}">
                                <img src="{{itemRam.document_file_path}}" style="width:100%;" />
                            </div>
                        </div>
                    </div>
                    <div class="row" ng-if="!(data_details[0].id_ram==5)">
                        <div class="row">
                            <div class="col-4 d-flex justify-content-end gap-10">
                            </div>
                            <div class="col-8 d-flex justify-content-center"
                                 style="padding: 20px 20px 20px 50px; gap: 160px">
                                <div class="d-flex justify-content-end align-items-center flex-column"
                                     ng-repeat="item_ram in master_likelihood_level | filter:{id_ram:data_details[0].id_ram,columns_level:item_ram.columns_level}">
                                    <label for="likelihood"><b>{{item_ram.likelihood_level}}</b></label>
                                    <input type="radio" id="likelihood"
                                           checked="{{cal_ram_action_likelihood == item_ram.likelihood_level}}"
                                           name="likelihood" ng-click="selectDataRAM('l',item_ram.likelihood_level)"
                                           style="cursor: pointer;width:30px; height:30px;">
                                </div>
                            </div>
                        </div>

                        <div class="col-1 d-flex flex-column justify-content-end"
                             style="gap: 63px; padding-bottom: 20px;">
                            <div class="d-flex justify-content-end align-items-center gap-2"
                                 ng-repeat="item_ram in master_security_level | filter:{id_ram:data_details[0].id_ram,category_type:item_ram.category_type}">
                                <label for="security_level"><b>{{item_ram.security_level}}</b></label>
                                <input type="radio" id="security_level"
                                       checked="{{cal_ram_action_security == item_ram.security_level}}"
                                       name="security_level" ng-click="selectDataRAM('s',item_ram.security_level)"
                                       style="cursor: pointer;width:30px; height:30px;">
                            </div>
                        </div>

                        <div class="col-11">
                            <div class="cursor-pointer "
                                 ng-repeat="itemRam in master_ram | filter:{id: data_details[0].id_ram}">
                                <img src="{{itemRam.document_file_path}}" style="width:100%;" />
                            </div>
                        </div>
                    </div>

                </div>

            </div>

        </div>
    </div>
    @* Modal RAM End *@

    <div class="modal fade" id="modalMsgConfirm" tabindex="-1" aria-labelledby="modalMsgConfirmLabel" aria-hidden="true"
         style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="text-900 mb-0" data-anchor="data-anchor" id="modalMsgConfirmLabel" style="font-size:25px;">
                        <span class=" me-2 text-primary"><B>|</B></span> Do you want to update and close the item?
                    </h5>

                    <button class="btn p-1" type="button" data-bs-dismiss="modal" aria-label="Close">
                        <svg class="svg-inline--fa fa-xmark fs--1" aria-hidden="true" focusable="false"
                             data-prefix="fas" data-icon="xmark" role="img" xmlns="http://www.w3.org/2000/svg"
                             viewBox="0 0 320 512" data-fa-i2svg="">
                            <path fill="currentColor"
                                  d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z">
                            </path>
                        </svg>
                    </button>

                </div>
                <div class="modal-body">
                    <button class="btn btn-success me-1 mb-1" type="button">Yes</button>
                </div>
            </div>
        </div>
    </div>

    <!--Modal Check ปุ่ม Submit-->
    <div class="modal fade" id="modalConfirmSubmit" tabindex="-1" aria-labelledby="modalConfirmSubmitLabel"
         aria-hidden="true" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="width: 100%; min-height: 300px;">
                <div class="modal-header justify-content-center align-items-center bg-primary" style="display: flex !important;">
                    <div class="d-flex mb-2 d-none">
                        <i class="fa-solid fa-envelope-open-text fa-lg"
                           style="color: rgb(255, 255, 255); font-size: 80px; font-weight: bold;"></i>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-center align-items-center mb-5">
                        <h5 ng-if="!ready_to_complate" class="modal-title mb-0 text-center" id="modalConfirmSubmitLabel" style="font-size: 40px; font-weight: bold;">
                            Do you want to update and close the item?
                        </h5>
                        <h5 ng-if="ready_to_complate" title="Popup แจ้งกรณีที่เป็นการ Approve รายการสุดท้าย" class="modal-title mb-0 text-center"
                            id="modalConfirmSubmitLabel" style="font-size: 25px; font-weight: bold;">
                            {{pha_sub_software =='whatif'?"What's If": pha_sub_software }} Ready to complate. <br />Do you want to update and close the item?
                        </h5>
                    </div>
                </div>

                <div class="modal-footer">
                    <div class="row col-12 justify-content-between">
                        <!-- เพิ่ม class justify-content-between เพื่อจัดปุ่มไปทางขวาและซ้าย -->
                        <div class=" col-auto">
                            <span class="mx-1" ng-if="submit_type">
                                <button class="btn btn-success btn-sm col-auto"
                                        ng-if="!(flow_status == 14)"
                                        ng-click="ConfirmDialogSubmit('confirm_submit_reviewer')">
                                    Submit to Reviewer
                                </button>
                                <button class="btn btn-success btn-sm col-auto"
                                        ng-if="(flow_status == 14)"
                                        ng-click="ConfirmDialogSubmit('confirm_approve_close')">
                                    Approve and Close
                                </button>
                            </span>
                        </div>
                        <div class=" col-auto justify-content-end">
                            <span class="mx-1" ng-if="submit_type">
                                <button class="btn btn-default btn-sm col-auto"
                                        style="background-color: #c9c5c5;"
                                        ng-click="ConfirmDialogSubmit('confirm_cancel')">
                                    Cancel
                                </button>
                            </span>
                        </div>
                    </div>
                </div>



            </div>
        </div>
    </div>
    <!--Modal Check ปุ่ม Submit-->
    <!--Modal Export File Start-->
    <div class="modal fade" id="modalExportFile" tabindex="-1" aria-labelledby="modalExportFileLabel"
         aria-hidden="true" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalExportFileLabel">Download File</h5>
                    <button class="btn p-1" type="button" data-bs-dismiss="modal" aria-label="Close">
                        <svg class="svg-inline--fa fa-xmark fs--1" aria-hidden="true" focusable="false" data-prefix="fas"
                             data-icon="xmark" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"
                             data-fa-i2svg="">
                            <path fill="currentColor"
                                  d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z">
                            </path>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">

                    <div class="bg-white position-relative top-1">

                        <a href="{{exportfile[0].DownloadPath}}" id="exportfile" name="exportfile" target="_blank">
                            {{exportfile[0].Name}}
                        </a>

                    </div>

                </div>

            </div>
        </div>
    </div>
    <!--Modal Export File End-->
    <!--Modal Export File Responder Start-->
    <div class="modal fade" id="modalExportResponderFile" tabindex="-1" aria-labelledby="modalExportResponderFileLabel"
         aria-hidden="true" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalExportResponderFileLabel">Download File Action Owner</h5>
                    <button class="btn p-1" type="button" data-bs-dismiss="modal" aria-label="Close">
                        <svg class="svg-inline--fa fa-xmark fs--1" aria-hidden="true" focusable="false" data-prefix="fas"
                             data-icon="xmark" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"
                             data-fa-i2svg="">
                            <path fill="currentColor"
                                  d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z">
                            </path>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="bg-white position-relative top-1"
                         ng-repeat="item_x in filteredData = (data_drawingworksheet_responder | filter:{id_worksheet:id_worksheet_select})">
                        <div ng-if="$index === 0 || item_x.id_worksheet !== filteredData[$index - 1].id_worksheet">
                            <a href="{{item_x.document_file_path}}" target="_blank">
                                {{item_x.document_file_name}}
                            </a>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>
    <!--Modal Export File Responder End-->
    <!--Modal Export File Reviewer Start-->
    <div class="modal fade" id="modalExportReviewerFile" tabindex="-1" aria-labelledby="modalExportReviewerFileLabel"
         aria-hidden="true" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalExportReviewerFileLabel">Download File Reviewer</h5>
                    <button class="btn p-1" type="button" data-bs-dismiss="modal" aria-label="Close">
                        <svg class="svg-inline--fa fa-xmark fs--1" aria-hidden="true" focusable="false" data-prefix="fas"
                             data-icon="xmark" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"
                             data-fa-i2svg="">
                            <path fill="currentColor"
                                  d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z">
                            </path>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">

                    <div class="bg-white position-relative top-1"
                         ng-repeat="item_x in data_drawingworksheet_reviewer | filter:{id_worksheet:id_worksheet_select}">
                        <a href="{{item_x.document_file_path}}" target="_blank">
                            {{item_x.document_file_name}}
                        </a>
                    </div>

                </div>

            </div>
        </div>
    </div>
    <!--Modal Export File Reviewer End-->
    <!--Modal Save Start-->
    <div class="modal fade" id="modalMsg" tabindex="-1" aria-labelledby="modalMsgLabel"
         aria-hidden="true" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="width: 100%; min-height: 300px;">
                <div class="modal-header justify-content-center align-items-center" style="display: flex !important;"
                     ng-class="{ 'bg-warning' : (Action_Msg_Header == 'Warning'? true :false),'bg-primary' : (Action_Msg_Header == 'Warning'? false :true) }">
                    <div class="d-flex mb-2 d-none">
                        <i class="fa-solid fa-triangle-exclamation fa-lg" ng-if="Action_Msg_Header == 'Warning'"
                           style="color: rgb(255, 255, 255); font-size: 80px; font-weight: bold;"></i>
                        <i class="fa-solid fa-circle-check fa-lg" ng-if="Action_Msg_Header != 'Warning'"
                           style="color: rgb(255, 255, 255); font-size: 80px; font-weight: bold;"></i>
                    </div>
                </div>
                <div class="modal-body" ng-if="Action_Msg_Header == 'Success'">
                    <div class="d-flex justify-content-center align-items-center mb-3">
                        <h5 class="mb-0 text-center " style="font-size: 40px; font-weight: bold;" data-anchor="data-anchor" id="modalMsgLabel">
                            {{Action_Msg_Header}}
                        </h5>
                    </div>
                    <div class="d-flex justify-content-center align-items-center mt-3 mb-3">
                        <p class="lh-lg mb-0 text-center" style="font-size: 16px;">
                            {{ Action_Msg_Detail}}
                        </p>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!--Modal Save End-->
    @* Modal Export Templates Start*@
    <div class="modal fade" id="modalTemplates" tabindex="-1" aria-labelledby="modalmodalTemplatesLabel"
         aria-hidden="true" style="display: none;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTemplatesLabel">Download Templates</h5>
                    <button class="btn p-1" type="button" data-bs-dismiss="modal" aria-label="Close">
                        <svg class="svg-inline--fa fa-xmark fs--1" aria-hidden="true" focusable="false" data-prefix="fas"
                             data-icon="xmark" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"
                             data-fa-i2svg="">
                            <path fill="currentColor"
                                  d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z">
                            </path>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="bg-white position-relative top-1">
                        <a href="{{exportfile[0].DownloadPath}}" id="templates" name="templates" target="_blank">
                            {{exportfile[0].Name}}
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @* Modal Export Templates End*@

</div>

@section Scripts {

    <script src="~/assets/js/angular.min.js"></script>
    <script src="~/assets/js/lodash.min.js"></script>
    <script src="~/assets/js/phoenix.js"></script>
    <script src="~/assets/js/choices.min.js"></script>
    <script src="~/assets/js/fakedata.js"></script>

    <script src="~/js/_flow/hazopfollowup_update.js"></script>


}